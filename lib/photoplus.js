// Generated by CoffeeScript 1.7.1
(function() {
  define(['jquery', 'flight/lib/component', 'components/data/with_listing_media'], function($, defineComponent, withListingMedia) {
    var photoPlus;
    photoPlus = function() {
      this.defaultAttrs({
        gallerySelector: ".scrollableArea",
        leftHotspotSelector: ".scrollingHotSpotLeft",
        rightHotspotSelector: ".scrollingHotSpotRight",
        imageCounterSelector: ".scroll_image_counter",
        processing: false,
        currentImage: 1
      });
      this.current = function(image) {
        if (image == null) {
          image = this.attr.currentImage;
        }
        if (this.total() === 0) {
          this.attr.currentImage = 0;
        }
        return this.attr.currentImage = image;
      };
      this.dataSelector = function() {
        var dataSelectorId;
        dataSelectorId = '#photo_plus_result_' + this.listingId;
        return $(dataSelectorId);
      };
      this.total = function() {
        return this.dataSelector().data('num_media');
      };
      this.includeFloorplans = function() {
        var result;
        result = this.dataSelector().data('floorplans_flag');
        return Boolean(result);
      };
      this.gallery = function() {
        return this.select('gallerySelector');
      };
      this.populateGallery = function(media) {
        var photos;
        this.gallery().width(this.galleryWidth);
        if (this.galleryPopulated()) {
          return;
        }
        if (this.includeFloorplans) {
          photos = media.photos.concat(media.floorplans);
        } else {
          photos = media.photos;
        }
        $(photos.slice(1)).each((function(_this) {
          return function(index, photo) {
            var html;
            html = "<a href='" + _this.href + "'>";
            html += "<img src='http://image.apartmentguide.com" + photo.path + "' ";
            html += "width='" + _this.imageWidth + "px' height='105px'></a>";
            return _this.gallery().append(html);
          };
        })(this));
        return this.gallery().find("img:first").addClass('current');
      };
      this.galleryPhotoCount = function() {
        return this.gallery().find('a').length;
      };
      this.galleryPopulated = function() {
        return this.galleryPhotoCount() > 1;
      };
      this.imageCount = function() {
        return "" + (this.current()) + "/" + (this.total());
      };
      this.next = function() {
        var image;
        if (!this.galleryPopulated()) {
          this.getPhotoPlusMedia(this.listingId);
        }
        image = this.current();
        if (image !== this.total()) {
          this.current(image += 1);
          this.updateCounter(image);
          return this.browse('right');
        }
      };
      this.previous = function() {
        var image;
        image = this.current();
        if (image !== 1) {
          this.current(image -= 1);
          this.updateCounter(image);
          return this.browse('left');
        }
      };
      this.updateCounter = function(num) {
        this.select('gallerySelector').find('img.current').removeClass('current');
        this.select('gallerySelector').find("a:nth-child(" + num + ") img").addClass('current');
        return this.select('imageCounterSelector').html(this.imageCount());
      };
      this.browse = function(direction) {
        var options;
        if (!this.processing) {
          this.processing = true;
          options = (function() {
            switch (direction) {
              case 'left':
                return {
                  right: "-=" + this.imageWidth + "px"
                };
              default:
                return {
                  right: "+=" + this.imageWidth + "px"
                };
            }
          }).call(this);
          return this.select('gallerySelector').animate(options, 400, (function(_this) {
            return function() {
              return _this.processing = false;
            };
          })(this));
        }
      };
      return this.after('initialize', function() {
        this.href = this.$node.find('a').attr('href');
        this.imageWidth = this.$node.width();
        this.listingId = this.$node.closest('.result').attr('id').split("_")[1];
        this.galleryWidth = this.imageWidth * this.total();
        this.select('imageCounterSelector').html(this.imageCount());
        this.on('click', {
          rightHotspotSelector: this.next,
          leftHotspotSelector: this.previous
        });
        return this.on('infoWindowDataAvailable', this.select('imageCounterSelector').html(this.imageCount()));
      });
    };
    return defineComponent(photoPlus, withListingMedia);
  });

}).call(this);
